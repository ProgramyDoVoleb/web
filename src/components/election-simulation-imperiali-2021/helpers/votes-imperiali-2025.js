export const db = [
  {name: "Sněmovní volby 2025",
    votersInRegions: [903298, 1071115, 507836, 448999, 225900, 632844, 342507, 432748, 404088, 400975, 963958, 501178, 460382, 957488],
    voters:          [645322,  763448, 352907, 306492, 137206, 392130, 233091, 305361, 288572, 290819, 675399, 343842, 321182, 634864],
    envelopes:       [644472,  762451, 352730, 306342, 137070, 391866, 232959, 305238, 288470, 290669, 674531, 343627, 321011, 633871],
    votes:           [636042,  754016, 348347, 302986, 135439, 387602, 230132, 301924, 285378, 287922, 667622, 340059, 317779, 626469],
    overseasCount:   37654,
    overseasVoters:  29888,
    overseasVotes:   27945,
    xxx: null
  }
]

export const results2021 = [
  {VSTRANA: 768, hash: 'ano-2011', sum: 0, pct: 34.51, rs: 34.51, requires: 5,
    votes: [126170,	234681,	121501,	113063,	57555,	173864,	79181,	101557,	98797,	103972,	215596,	131683,110814, 272073],
    regpct: [19.83,	31.12,	34.87,	37.31,	42.49,	44.85,	34.40,	33.63,	34.61,	36.11,	32.29,	38.72,	34.87,	43.42],
    overseas: 0
  },
  {VSTRANA: 1327, hash: 'spolu-ods-kducsl-top09', sum: 0, pct: 23.36, rs: 23.36, requires: 11,
    votes: [216098,	183391,	82278,	63598,	20871,	59706,	41567,	71268,	67422,	67037,	181892,	68520,	77049,	112649],
    regpct: [33.97,	24.32,	23.61,	20.99,	15.40,	15.40,	18.06,	23.60,	23.62,	23.28,	27.24,	20.14,	24.24,	17.98],
    overseas: 0
  },
  {VSTRANA: 166, hash: 'starostove-a-nezavisli', sum: 0, pct: 11.23, rs: 11.23, requires: 8,
    votes: [85260,	103451,	37512,	32179,	14828,	37252,	37609,	36872,	31535,	33976,	64307,	31830,	32444,	52457	],
    regpct: [13.40,	13.72,	10.76,	10.62,	10.94,	9.61,	16.34,	12.21,	11.05,	11.80,	9.63,	9.36,	10.20,	8.37],
    overseas: 0
  },
  {VSTRANA: 720, hash: 'ceska-piratska-strana', sum: 0, pct: 8.97, rs: 8.97, requires: 5,
    votes: [107442,	68571,	26467,	23582,	8801,	27012,	18891,	24333,	22015,	20373,	63119,	24942,	23967,	45022],
    regpct: [16.89,	9.09,	7.59,	7.78,	6.49,	6.96,	8.20,	8.05,	7.71,	7.07,	9.45,	7.33,	7.54,	7.18],
    overseas: 0
  },
  {VSTRANA: 1114, hash: 'svoboda-a-prima-demokracie---spd', sum: 0, pct: 7.78, rs: 7.78, requires: 5,
    votes: [33292,	53242,	27650,	26908,	13837,	35408,	19914,	23404,	21938,	21099,	50344,	32084,	27784,	50707],
    regpct: [5.23,	7.06,	7.93,	8.88,	10.21,	9.13,	8.65,	7.75,	7.68,	7.32,	7.54,	9.43,	8.74,	8.09],
    overseas: 0
  },
  {VSTRANA: 1178, hash: 'motoriste-sobe', sum: 0, pct: 6.77, rs: 6.77, requires: 5,
    votes: [32791,	58574,	24535,	21701,	9868,	26324,	16933,	22981,	22155,	19588,	40952,	22586,	21352,	40261],
    regpct: [5.15,	7.76,	7.04,	7.16,	7.28,	6.79,	7.35,	7.61,	7.76,	6.80,	6.13,	6.64,	6.71,	6.42],
    overseas: 0
  },
  {VSTRANA: 1298, hash: 'stacilo', sum: 0, pct: 4.3, rs: 4.3, requires: 5,
    votes: [17461,	27385,	16717,	12932,	5548,	16748,	9620,	12724,	12885,	13537,	29513,	17575,	14789,	34597],
    regpct: [2.74,	3.63,	4.79,	4.26,	4.09,	4.32,	4.18,	4.21,	4.51,	4.70,	4.42,	5.16,	4.65,	5.52],
    overseas: 0
  },
  {VSTRANA: 1245, hash: 'prisaha', sum: 0, pct: 1.07, rs: 1.07, requires: 5,
    votes: [4561,	7969,	4052,	3085,	1414,	4479,	2233,	3278,	3338,	3477,	8992,	4029,	3552,	6044],
    regpct: [0.71,	1.05,	1.16,	1.01,	1.04,	1.15,	0.97,	1.08,	1.16,	1.20,	1.34,	1.18,	1.11,	0.96],
    overseas: 0
  }
]

export const coefs2 = [
  {VSTRANA: 53, coef:[1.44, 1.03, 1.05, 0.96, 0.73, 0.71, 0.82, 1.03, 1.03, 1.01, 1.08, 0.88, 1.00, 0.74]},
  {VSTRANA: 721, coef:[1.44, 1.03, 1.05, 0.96, 0.73, 0.71, 0.82, 1.03, 1.03, 1.01, 1.08, 0.88, 1.00, 0.74]},
  {VSTRANA: 1, coef:[1.44, 1.03, 1.05, 0.96, 0.73, 0.71, 0.82, 1.03, 1.03, 1.01, 1.08, 0.88, 1.00, 0.74]},
  {VSTRANA: 720, coef:[1.45, 1.25, 0.86, 0.89, 0.91, 0.90, 1.37, 0.97, 0.90, 0.86, 0.91, 0.79, 0.86, 0.71]},
  {VSTRANA: 166, coef:[1.45, 1.25, 0.86, 0.89, 0.91, 0.90, 1.37, 0.97, 0.90, 0.86, 0.91, 0.79, 0.86, 0.71]}
];

export const coefs = [
  {VSTRANA: 53, coef:[1.34, 1.15, 1.08, 0.92, 0.82, 0.77, 0.94, 0.98, 0.96, 1.02, 1.07, 0.79, 0.87, 0.83]},
  {VSTRANA: 721, coef:[1.68, 1.21, 1.02, 0.93, 0.71, 0.69, 0.71, 0.89, 0.84, 0.83, 1.24, 0.77, 0.77, 0.65]},
  {VSTRANA: 1, coef:[1.04, 0.80, 0.86, 0.78, 0.56, 0.58, 0.71, 0.95, 1.05, 1.03, 1.16, 1.03, 1.27, 0.76]},
  {VSTRANA: 720, coef:[1.58, 1.12, 0.91, 0.89, 0.72, 0.90, 1.01, 1.00, 0.95, 0.95, 1.00, 0.83, 0.75, 0.78]},
  {VSTRANA: 166, coef:[1.22, 1.36, 0.9, 0.89, 1.00, 0.90, 1.84, 0.87, 0.86, 0.78, 0.82, 0.75, 1.10, 0.64]}
];

results2021.forEach(party => {
  party.coef = [];

  party.regpct.forEach(rp => {
    party.coef.push(rp / party.rs);
  });

  party.sumall = party.votes.reduce((a, b) => a + b, 0)
});

export const elections = [
  'Sněmovní volby 2025'
]

export const attendance = [];
export const votersInRegions = [];
export const errorInRegion = [];

db[0].votes.forEach((v, i) => {
  votersInRegions.push(db[0].votersInRegions[i]);
  attendance.push(db[0].votes[i] / db[0].votersInRegions[i] * 100);
  errorInRegion.push(db[0].votes[i] / db[0].voters[i] * 100);
});

/**

export const attendance = [
  615519/916940*100,
  664722/1047853*100,
  317250/513882*100,
  273374/456299*100,
  123107/236250*100,
  341783/652568*100,
  210363/350307*100,
  280822/444016*100,
  259860/412172*100,
  264356/412847*100,
  587458/951420*100,
  307825/515014*100,
  296748/477700*100,
  551446/987233*100
]

const votersInRegions = [
  916940, 1031208, 513882, 456299, 236250, 652568, 350307, 444016, 412172, 412847, 951420, 515014, 477700, 987233
]

const errorInRegion = [
  611450/615519*100,
  660619/664722*100,
  315319/317250*100,
  271510/273374*100,
  122142/123107*100,
  339686/341783*100,
  208817/210363*100,
  278720/280822*100,
  258169/259860*100,
  262764/264356*100,
  583442/587458*100,
  305639/307825*100,
  294679/296748*100,
  547789/551446*100
]

*/

export function votes (id, att, tick) {

  // console.log(att, id);

  var sum = 0, perMandate = 0, votes = [], list = [];

  var attendanceValues = att || attendance;

  if (id > 0) {

    votersInRegions.forEach((voters, index) => {
      list.push(
        Math.round(voters * attendanceValues[index] / 100)
      );
    })
    votes = list;
  } else {

    (att || db[id].votes).forEach(voters => {
      list.push(voters)
    })
    votes = list;
  }

  votes.forEach(v => sum += v);
  perMandate = Math.round(sum / 200);

  return {
    sum, perMandate, votes, tick
  }
}

export function chairs (votes, perMandate) {
  var list = [];

  var spent = 200;

  votes.forEach((vote, index) => {

    var chairs = Math.floor(vote / perMandate)

    var obj = {
      region: index,
      votes: vote,
      chairs: chairs,
      remain: vote % perMandate,
      extra: 0
    }

    spent -= chairs;

    list.push(obj);
  });

  list.sort((a, b) => b.remain - a.remain);

  list.forEach(region => {
    if (spent > 0) {
      spent--;
      region.extra++;
    }
  });

  list.sort((a, b) => a.region - b.region);

  list.forEach(item => item.total = item.chairs + item.extra);

  return list;
}

export function scrutinizeRegion (chairsCount, parties) {
  var list = [];

  parties.forEach(party => {
    for (var i = 1; i <= chairsCount; i++) {
      var obj = {
        hash: party.hash,
        VSTRANA: party.VSTRANA,
        division: Math.floor(party.votes / i)
      }

      list.push(obj);
    }
  });

  list.sort((a, b) => b.division - a.division);
  // list = list.slice(0, chairsCount);

  return list;
}

export function scrutinize (chairs, parties, tick) {

  var regions = [];

  // // console.log(chairs, parties);

  chairs.forEach((data, index) => {
    var obj = {
      chairs: data.chairs + data.extra,
      parties: [],
      mandates: [],
      tick
    }

    parties.forEach(party => {
      var o = {
        hash: party.hash,
        VSTRANA: party.VSTRANA,
        votes: party.votes[index]
      }

      // // console.log(party.pct, party.requires)

      if (party.pct >= party.requires) {
        obj.parties.push(o);
      }
    })

    var scr = scrutinizeRegion(obj.chairs, obj.parties);
    scr = scr.slice(0, obj.chairs);

    parties.forEach(party => {
      var o = {
        hash: party.hash,
        VSTRANA: party.VSTRANA,
        mandates: scr.filter(x => x.hash === party.hash || x.VSTRANA === party.VSTRANA).length
      }

      obj.mandates.push(o);
    })

    obj.mandates.sort((a, b) => b.mandates - a.mandates);

    regions.push(obj);

  });

  var p = [];

  parties.forEach(party => {
    var o = {
      hash: party.hash,
      VSTRANA: party.VSTRANA,
      regions: [],
      sum: 0
    }

    regions.forEach(reg => {
      o.regions.push(reg.mandates.find(x => x.hash === party.hash || x.VSTRANA === party.VSTRANA).mandates);
    });

    o.regions.forEach(count => {
      o.sum += count;
    });

    p.push(o);
  })

  return {
    regions,
    parties: p
  };
}

export function turnout (attendanceCustom, votersCustom, tick, overseas, defined) {
  // var attendanceValues = attendanceCustom || attendance;
  var votersValues;

  if (votersCustom) {
    votersValues = votersCustom
  } else {
    votersValues = [];

    votersInRegions.forEach((voters) => {
      votersValues.push(voters)
    })
  }

  var voters = [];
  var sum = 0;
  var all = 0;

  votersValues.forEach((votersRegional, index) => {
    var r = db[0].votes[index]; // Math.round(votersRegional * attendanceValues[index] * errorInRegion[index] / 10000);

    // r += overseas === index ? db[0].overseasCount : 0;

    // r = r + overseas - overseas;

    sum += r;
    all += votersRegional;

    voters.push(r);
  });

  if (defined && defined.data.attendanceSum) {
    all = defined.data.attendanceCount.reduce((a, b) => a+b, 0);
    sum = defined.data.attendanceSum;
    voters = defined.data.attendanceCount; // .map((x, i) => Math.floor(x * defined.data.attendanceCustom[i] / 100));
  }

  return {
    voters,
    sum,
    all,
    pct: Math.round(10000 * sum / all) / 100,
    tick
  }
}
