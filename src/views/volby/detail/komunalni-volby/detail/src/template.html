<div class="komunalni-volby">
	<template v-if="current.status === 3 && current.$ucast.length > 0">
		<template v-for="(obvod, index) in obvody">
			<component :is="obvod.OBVODY === 2 ? 'p-block-expandable' : 'div'" :headline="'Obvod ' + (index + 1)">
				<p-block headline="Výsledky">
					<p-area class="relative">
						<election-graph :list="sortByVotes(current.$vysledky, current.$strany, obvod.OBVODY === 2 ? index + 1 : null)"></election-graph>
						<div class="p-gap"></div>
						<p-collapsible label="Podrobné výsledky">
							<election-table :list="sortByVotes(current.$vysledky, current.$strany, obvod.OBVODY === 2 ? index + 1 : null)"></election-table>
						</p-collapsible>
						<div class="attendance">
							<p-line-graph :value="current.$ucast.find(x => obvod.OBVODY === 2 ? x.OBVOD === obvod.COBVODU : true).UCAST" color="var(--blue)"></p-line-graph>
							<div class="text-right smallest dimm">účast</div>
						</div>
					</p-area>
				</p-block>
				<div class="p-gap_2"></div>
				<p-block headline="Statistiky" v-if="current.$ucast">
					<p-area>
						<election-stats :data="current.$ucast.find(x => obvod.OBVODY === 2 ? x.OBVOD === obvod.COBVODU : true)" :results="current.$vysledky"></election-stats>
					</p-area>
				</p-block>
			</component>
		</template>
		<p-block headline="Zvolení zastupitelé">
			<component :is="consolidate(people(sortByVotes(current.$vysledky, current.$strany), current.$zvoleni)).length > 100 ? 'election-list' : 'election-grid'" :list="consolidate(people(sortByVotes(current.$vysledky, current.$strany), current.$zvoleni))"></component>
		</p-block>
		<p-block headline="Kandidáti">
			<component :is="current.$kandidati.length > 10 ? 'election-list' : 'election-grid'" :list="people(parties(current.$strany, current.$strany), current.$kandidati, true)"></component>
		</p-block>
	</template>
	<template v-if="current.status === 3 && current.$ucast.length === 0">
		<p-area borderColor="var(--red)" class="strong">Volby neproběhly, nebyla registrovaná ani jedna kandidátní listina.</p-area>
		<div class="p-gap_3"></div>
	</template>
	
	<template v-if="current.status === 1">
		<p-block headline="Předběžný přehled" :hide="true">
			<div class="p-offset reverse balanced">
				<div>
					<h2><button class="inline" @click="compactList = true" :class="{'active': compactList}">Seznam</button> / <button class="inline" @click="compactList = false" :class="{'active': !compactList}">Přehled</button></h2>
				</div>
				<div v-if="current.status === 1">
					<p-modal>
						<template #init>
							<p-label color="var(--red)" class="smaller strong red">Předběžný přehled</p-label>
						</template>
						<template #content>
							<p>Zde najdete přehled stran a kandidátů, kteří už nějakou formou oznámili záměr nebo odhodlání kandidovat. Kandidáti uvedeni s číslem již byli oznámeni na té pozici kandidátky, ostatní jsou řazeni dle abecedy a nemusí být součástí finální podoby kandidátky. Pořadí a složení se může měnit. Tento přehled bude nahrazen za oficiální přehled, který vydává Český statistický úřad, cca 45 dní před volbami.</p>
						</template>
					</p-modal>
				</div>
			</div>	
			<div class="p-gap"></div>
			<p-columns>
				<div v-for="(party, index) in sortBy(current.$strany, (compactList ? 'ZKRATKA' : 'NAZEV'), '', true)">
					<component :is="compactList ? 'party-preview' : 'party-preview-large'" :link="'/volby/komunalni-volby/' + current.id" :party="party" :candidates="current.$kandidati.filter(x => x.OSTRANA === party.OSTRANA)" :election="null" :elections="data"></component>
				</div>
				<div v-if="current.$strany.length === 0">
					<p-area icon="icon-none" class="smaller">
						<strong>Zatím zde není žádná strana</strong>
						<div class="smallest">Víte o nějaké? Dejte vědět</div>
					</p-area>
				</div>
			</p-columns>
			<!-- <election-grid :leaders="true" :list="people(parties(current.$strany, current.$strany), current.$kandidati, true)"></election-grid> -->
			<template v-if="current.status < 2">
				<div class="p-line"></div>
				<div class="smallest dimm">
					<div class="p-offset">
						<div>
							<report-modal headline="Pošlete odkaz a případně přidejte poznámku." :part="'KV:' + current.id + ':' + town">
								<strong class="green">Přidat či upravit</strong>
							</report-modal>
						</div>
						<div>
							Kompletní seznam registrovaných stran a hnutí bude znám koncem srpna 2026
						</div>
					</div>					
				</div>
			</template>
		</p-block>
	</template>
	<p-block v-if="data.list[0].$otazky && data.list[0].$otazky.length > 0" headline="Otázky a odpovědi">
		<template v-for="(qitem, qindex) in qenum">
			<p-collapsible :label="qitem.label" :status="data.list[0].$otazky.filter(x => x.type === qitem.type).length" v-if="data.list[0].$otazky.filter(x => x.type === qitem.type).length > 0">
				<p-area>
					<div :class="qitem.type < 3 ? 'columns' : 'p-list'">
						<div v-for="(qquestion, qqindex) in data.list[0].$otazky.filter(x => x.type === qitem.type && x.priority === 1)">
							<router-link class="strong" :to="'/volby/komunalni-volby/' + data.list[0].id + '/' + qitem.hash + '/' + qquestion.id + '?vyber=' + town">{{ qquestion.question }}</router-link>
							<div class="smaller" v-if="qquestion.comment">{{ truncate(qquestion.comment, 12) }}</div>
						</div>
					</div>
					<template v-if="data.list[0].$otazky.find(x => x.type === qitem.type && x.priority === 2)">
						<div class="p-gap"></div>
						<p-collapsible label="Doplňkové otázky">
							<div :class="qitem.type < 3 ? 'columns' : 'p-list'">
								<div v-for="(qquestion, qqindex) in data.list[0].$otazky.filter(x => x.type === qitem.type && x.priority === 2)">
									<router-link :to="'/volby/komunalni-volby/' + data.list[0].id + '/' + qitem.hash + '/' + qquestion.id + '?vyber=' + town">{{ qquestion.question }}</router-link>
								</div>
							</div>
						</p-collapsible>
					</template>
				</p-area>
			</p-collapsible>
		</template>
	</p-block>
	<p-block headline="Minulé volby">
		<election-results id="154" :type="{key: 'KV', hash: 'komunalni-volby', name: 'Komunální volby'}" :election="{'datum_label': '23. a 24. září 2022'}" :spec="town" :label="data.list[0].$dotcene[0].NAZEVZAST"></election-results>
	</p-block>
</div>